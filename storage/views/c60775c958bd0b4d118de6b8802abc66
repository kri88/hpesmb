<?php $__env->startSection('pagetitle', $heading); ?>


<?php $__env->startSection('head'); ?>
@parent
<meta name="description" content="">
<?php $__env->stopSection(); ?>

<?php $__env->startSection('header'); ?>
<header id="side">
    <h1><?php echo Lang::get('general.title'); ?></h1>
    <small><?php echo Lang::get('general.sub-title'); ?></small>
    <nav id="steps" class="clearfix">
        <?php foreach($menu as $key=>$pages): ?>
            <?php if($pages['display']): ?>
            <div class="<?php echo $pages['class']; ?> <?php echo $pages['complete'] || $key==$section ? 'passed':''; ?>">
                <i></i><!--<?php echo var_dump($pages['complete']); ?>-->
                <ul>
                <?php foreach($pages['pages'] as $pkey => $qpage): ?>
                    <li class="<?php echo $qpage['done'] || ($pkey == 'page'.$page && $key==$section)? 'done':''; ?>"><?php echo $pkey; ?></li>
                <?php endforeach; ?>
                </ul>
            </div>
            <?php endif; ?>
        <?php endforeach; ?>
        
    </nav>
    <h2><small><?php echo $menu[$section]['pages']['page'.$page]['progress']; ?></small> <?php echo $heading; ?></h2>
</header>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('main'); ?>
<section id="page" class="<?php echo $class; ?>">
    <?php foreach($questions as $question): ?>
    <h2><?php echo $question['question']; ?></h2>
    <?php echo Form::open(array('url' => 'quiz/'.$section.'/page'.$page,'id'=>'form-question','class'=>'clearfix question')); ?>

    <?php echo Form::errors($errors); ?>

        <?php echo Form::hidden('section', $section);; ?>

        <?php echo Form::hidden('page', $page);; ?>

        <?php foreach($questions as $num=>$q): ?>
            <?php if($q['type'] == 'radio'): ?>
                <?php echo Form::idcRadio($num,$q,'radio',$page); ?>

            <?php elseif($q['type'] == 'slider'): ?>
                <?php echo Form::idcSlider($num,$q,$page); ?>

            <?php elseif($q['type'] == 'checkbox'): ?>
                <?php echo Form::idcCheckbox($num,$q,$page); ?>

            <?php elseif($q['type'] == 'icon'): ?>
                <?php echo Form::idcIcon($section,$q,$page,$num); ?>

            <?php elseif($q['type'] == 'button'): ?>
                <?php echo Form::idcButton($section,$q,$page); ?>

            <?php elseif($q['type'] == 'text'): ?>
                <?php echo Form::idcInput($num,$q,$page); ?>

            <?php endif; ?>
        <?php endforeach; ?>
    <?php endforeach; ?>
    <?php echo Form::close(); ?>

</section>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('pagescript'); ?>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="<?php echo asset('js/vendor/jquery-1.10.1.min.js'); ?>"><\/script>')</script>
<script type="text/javascript">var error = false;</script>
<script src="<?php echo e(asset('js/plugins.js')); ?>"></script>
<script src="<?php echo e(asset('js/main.js')); ?>"></script>
<?php if($script): ?>
<script>
$(function() {
    <?php foreach($script as $s): ?>
       <?php echo $s; ?>

    <?php endforeach; ?>
});
</script>
<?php endif; ?>
<script>
jQuery(window).on("beforeunload", function(event){
      return "Are you sure you would like to leave this page? Your answers for this page will be lost";
});

<?php if($report): ?>
    var els;
    if($('button.btn-q').length){
        $('button.btn-q').click(function(e){
            $(this).addClass('check');
            e.preventDefault();
            el = e.target;
            setTimeout(
                function() {
                    var title = $(el).text();
                    var val = $(el).val();
                    var pos = $(el).position();
                    var parent = $(el).parent("fieldset");
                    var parentHeight = parent.css('height');
                    var num = $('button.btn-q').length;
                    var that = el;
                    if(num>0){
                        var start = 1;
                        //inject info
                        html = '<div class="repwrap">'+
                                    '<div class="repmod">'+
                                        '<h4 class="check">'+title+'</h4>'+
                                        /*'<div class="rep-img">'+
                                            '<img src="<?php echo URL::to("/").'/'.$report['image']; ?>" alt="" width="80" height="80">'+
                                        '</div>'+*/
                                        '<div class="rep-text">'+
                                            '<?php echo addslashes($report['text']); ?>'+
                                        '</div>'+
                                        '<div class="clearfix"></div>'+
                                    '</div>'+
                                    '<button class="btn btn-primary pull-right btn-lg" type="submit" value="'+val+'" name="answer"><?php echo Lang::get('general.next'); ?> <i class="fa fa-arrow-right"></i></button>'+
                                '</div>';
                        $(html).hide().appendTo(parent);
                        
                        //hide next buttton
                        $('div.repwrap').find('button.btn.btn-primary.pull-right').hide();
                        
                        //move out of view
                        $('div.repwrap').css({
                                position : "absolute",
                                top : pos.top,
                                left: -90000
                        });
                        $('div.repwrap').show();
                        //set original height for later
                        var repheight = $('div.repmod').height();
                        var headheight = $('div.repmod').find('h4').height();
                        $(parent).css({height: repheight+70 });
                        //set heigh to size of title
                        $('div.repmod').height(headheight+10);
                        //hide again
                        //$('div.repwrap').hide();
                        //move bak into view
                        $('div.repwrap').css({
                                left: 0
                        });
                        
                        
                        jQuery.each($('button.btn-q'), function( i, item ) {
                            $(item).fadeOut('fast', function() {
                                start++;
                                if(num == start){                               
                                    $('div.repwrap').fadeIn("fast",function(){
                                        if(pos.top!=0){
                                            $('div.repwrap').animate({
                                                top: 0
                                            }, 'slow', function() {
                                                $('div.repmod').animate({ height: repheight },400,function(){
                                                    $('div.repwrap').find('button.btn.btn-primary.pull-right').fadeIn("fast");
                                                });
                                            });
                                        }else{
                                            $('div.repmod').animate({ height: repheight },400,function(){
                                                $('div.repwrap').find('button.btn.btn-primary.pull-right').fadeIn("fast");
                                            });
                                        }
                                    });
                                }
                            });
                        });
                    }
                },
                500);
        })
    }
<?php else: ?>
    $('button.btn-q').click(function(e){
            e.preventDefault();
            var that = this;
            $(this).addClass('check');
            jQuery.each($('button.btn-q'), function( i, item ) {
                if(that!=item) $(item).prop( "disabled", true );
            });
            setTimeout(
                function() {
                    $(that).unbind('click').trigger('click');
                },
                500);
        })
<?php endif; ?>
if($('label.rel').length){
    $('button.btn.btn-primary.pull-right').click(function(e){
        var title = '<?php echo $heading; ?>';
        var sibling = $(this).prev("fieldset");
        var pos = false;
        var parentHeight = sibling.css('height');
        var num = $('label.rel').length;
        var selected = 0;
        if(num>0){
            $(sibling).find('input.chq').each(function( index ) {
                if($(this).is(':checked')){
                    selected ++;
                    pos = $(this).parents('label').position();
                }
            });
            if(selected>0){
                $('div.error').fadeOut('fast', function() {
                    this.remove();
                });

                <?php if($report): ?>
                e.preventDefault();
                var start = 0;
                $('button.btn.btn-primary.pull-right').fadeOut('fast');
                jQuery.each($('label.rel'), function( i, item ) {
                    $(item).fadeOut('fast', function() {
                        start++;
                        if(num == start && selected>0){
                                                                
                            //inject new thing
                            html = 
                                '<div class="repwrap">'+
                                    '<div class="repmod">'+
                                        '<h4 class="check">'+title+'</h4>'+
                                        /*'<div class="rep-img">'+
                                            '<img src="<?php echo URL::to("/").'/'.$report['image']; ?>" alt="" width="80" height="80">'+
                                        '</div>'+*/
                                        '<div class="rep-text">'+
                                            '<?php echo addslashes($report['text']); ?>'+
                                        '</div>'+
                                        '<div class="clearfix"></div>'+
                                    '</div>'+
                                    '<button class="btn btn-primary pull-right btn-lg" type="submit"><?php echo Lang::get('general.next'); ?> <i class="fa fa-arrow-right"></i></button></button>'+
                                '</div>';
                            
                            $(html).appendTo(sibling);
                        
                        }
                    });
                });

                <?php endif; ?>
            }else{
                e.preventDefault();
                if(error==false){
                    html = 
                        '<div class="error" style="padding:0 15px 0 15px;">'+
                            '<span style="color: #ed2024;"><?php echo Lang::get('general.multierror'); ?></span>'+
                        '</div>';
                    $(html).hide().appendTo(sibling).fadeIn("fast");
                    error=true;
                }
                
            }
        }
    })
}
</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('_layout.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>